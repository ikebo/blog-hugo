---
doc_type: weread-highlights-reviews
bookId: "31608464"
author: 朱凯
cover: https://cdn.weread.qq.com/weread/cover/26/YueWen_31608464/t7_YueWen_31608464.jpg
reviewCount: 0
noteCount: 54
readingStatus: 在读
progress: 57%
totalReadDay: 2
readingTime: 1小时9分钟
readingDate: 2021-12-23
isbn: 9787111654902
lastReadDate: 2021-12-24

---
# 元数据
> [!abstract] ClickHouse原理解析与应用实践
> - ![ ClickHouse原理解析与应用实践|200](https://cdn.weread.qq.com/weread/cover/26/YueWen_31608464/t7_YueWen_31608464.jpg)
> - 书名： ClickHouse原理解析与应用实践
> - 作者： 朱凯
> - 简介： 本书是一本系统介绍Clickhouse的指导型工具书，全书总共分为11章：第1章 介绍ClickHouse的由来、发展历程、核心特点与核心特点。第2~6章 介绍了ClickHouse基础使用部分，包括整体架构、如何安装、数据定义、数据引擎、数据查询和函数的特性和使用方法。第7~9章介绍了ClickHouse高级特性部分，包括数据库管理操作，数据分片、数据副本和高可用的特性和使用方法。第10~11章介绍了如果自己手动实现ClickHouse中间件的思路和示例，同时也介绍了几款可视化工具与ClickHouse集成的方法。
> - 出版时间 2020-05-01 00:00:00
> - ISBN： 9787111654902
> - 分类： 计算机-数据库
> - 出版社： 机械工业出版社
> - PC地址：https://weread.qq.com/web/reader/03532e3071e24e90035375d

# 高亮划线

## 推荐序一

> 📌 ，即向人们提供世界上最快的分析型数据库。 
> ⏱ 2021-12-23 09:21:49 ^31608464-3-5327-5347

> 📌 。使用该模式开发的典型产品就是SQLite数据库，它是由Richard Hipp一个人开发的。 
> ⏱ 2021-12-23 09:22:29 ^31608464-3-5523-5570

## 推荐序二

> 📌 ClickHouse比Spark快了近10倍。 
> ⏱ 2021-12-23 09:27:17 ^31608464-4-628-651

> 📌 尤其是Ad-hoc查询速度一直遥遥领先，因此被国内大量用户和爱好者广泛用在即席查询场景当中。 
> ⏱ 2021-12-23 09:27:50 ^31608464-4-748-794

> 📌 郭炜 
> ⏱ 2021-12-23 09:28:44 ^31608464-4-1312-1314

## 推荐序四

> 📌 作为面向OLAP领域的新一代解决方案，ClickHouse与OLTP系统有着显著不同。 
> ⏱ 2021-12-23 13:30:57 ^31608464-6-432-475

> 📌 它并不谋求多个节点之间的事务一致性（ACID） 
> ⏱ 2021-12-23 13:31:32 ^31608464-6-475-498

> 📌 ，而是以其独特、卓越的性能为切入点，以实现用户在海量数据下完成高效多维分析任务为诉求，而这也正是一款优秀的OLAP产品的特质（FASMI） 
> ⏱ 2021-12-23 13:31:49 ^31608464-6-498-567

## 推荐序五

> 📌 只要涉及在线分析场景，ClickHouse都能通过它那极致的性能占有一席之地。 
> ⏱ 2021-12-23 13:33:09 ^31608464-7-638-677

## 第1章 ClickHouse的前世今生

> 📌 分布式文件系统HDFS和MapReduce计 
> ⏱ 2021-12-23 13:46:48 ^31608464-15-684-706

> 📌 包括Yarn、Hive、HBase、Spark等数十种之多） 
> ⏱ 2021-12-23 13:47:01 ^31608464-15-746-776

> 📌 数据查询分析的手段也层出不穷，Spark、Impala、Kylin等百花齐放 
> ⏱ 2021-12-23 13:47:31 ^31608464-15-868-906

> 📌 例如分布式文件系统HDFS可以直接作为其他组件的底层存储（例如HBase、Hive等） 
> ⏱ 2021-12-23 13:48:07 ^31608464-15-1049-1092

> 📌 但生态化的另一面则可以看作臃肿和复杂。 
> ⏱ 2021-12-23 13:48:21 ^31608464-15-1128-1147

### 1.4 OLAP实现技术的演进

> 📌 以ROLAP架构为例，传统关系型数据库就被Hive和SparkSQL这类新兴技术所取代。 
> ⏱ 2021-12-24 12:54:33 ^31608464-19-793-837

> 📌 其预聚合结果的存储载体也转向HBase这类高性能分布式数据库。 
> ⏱ 2021-12-24 12:55:15 ^31608464-19-1041-1072

> 📌 。那是否存在这样一种技术，它既使用ROLAP模型，同时又拥有比肩MOLAP的性能呢？ 
> ⏱ 2021-12-24 12:56:09 ^31608464-19-1392-1434

### 1.5 一匹横空出世的黑马

> 📌 为了满足上述产品特性，我们在进行底层数据库技术选型的时候可谓是绞尽脑汁。 
> ⏱ 2021-12-24 12:58:10 ^31608464-20-1076-1112

> 📌 也有一种另辟蹊径的选择，即摒弃ROLAP和MOALP转而使用搜索引擎来实现OLAP查询，ElasticSearch是这类方案的代表 
> ⏱ 2021-12-24 12:59:07 ^31608464-20-1256-1321

#### 1.5.1 天下武功唯快不破

> 📌 在1亿数据集体量的情况下，ClickHouse的平均响应速度是Vertica的2.63倍、InfiniDB的17倍、MonetDB的27倍、Hive的126倍、MySQL的429倍以及Greenplum的10倍 
> ⏱ 2021-12-24 13:03:15 ^31608464-21-785-890

#### 1.6.1 顺理成章的MySQL时期

> 📌 这类分析场景更关注数据写入和查询的性能，不关心事务操作（MyISAM表引擎不支持事务特性）。相比InnoDB表引擎，MyISAM表引擎在分析场景中具有更好的性能。 
> ⏱ 2021-12-24 13:25:23 ^31608464-24-840-921

> 📌 MyISAM表引擎使用B+树结构存储索引，而数据则使用另外单独的存储文件（InnoDB表引擎使用B+树同时存储索引和数据，数据直接挂载在叶子节点中） 
> ⏱ 2021-12-24 13:28:25 ^31608464-24-1121-1195

> 📌 虽然Yandex又额外做了许多优化，成功地将90%的分析报告控制在26秒内返回 
> ⏱ 2021-12-24 13:30:11 ^31608464-24-1818-1857

#### 1.6.2 另辟蹊径的Metrage时期

> 📌 首先，在数据模型层面，它使用Key-Value模型（键值对）代替了关系模型；其次，在索引层面，它使用LSM树代替了B+树；最后，在数据处理层面，由实时查询的方式改为了预处理的方式。 
> ⏱ 2021-12-24 13:30:54 ^31608464-25-531-621

> 📌 最具代表性的使用LSM树索引结构的系统是HBase 
> ⏱ 2021-12-24 13:31:11 ^31608464-25-690-715

> 📌 ，所以能够进一步使用稀疏索引来优化查询性能 
> ⏱ 2021-12-24 13:37:16 ^31608464-25-953-974

> 📌 Metrage设计的第二个重大转变是通过预处理的方式，将需要分析的数据预先聚合。 
> ⏱ 2021-12-24 13:37:35 ^31608464-25-1099-1139

> 📌 接着预先计算立方体内的所有维度组合； 
> ⏱ 2021-12-24 13:37:58 ^31608464-25-1191-1209

> 📌 这套系统的实现思路和现今的一些MOLAP系统如出一辙。 
> ⏱ 2021-12-24 13:38:09 ^31608464-25-1276-1303

> 📌 截至2015年，在Metrage内存储了超过3万亿行的数据，其集群规模超过了60台服务器，查询性能也由先前的26秒降低到了惊人的1秒以内。 
> ⏱ 2021-12-24 13:38:36 ^31608464-25-1377-1446

#### 1.6.3 自我突破的OLAPServer时期

> 📌 关系模型拥有更好的描述能力。 
> ⏱ 2021-12-24 13:40:09 ^31608464-26-919-933

> 📌 在索引方面，它并没有完全沿用LSM树，而是使用了LSM树所使用到的稀疏索引。在数据文件的设计上，则沿用了LSM树中数据段的思想，即数据段内数据有序，借助稀疏索引定位数据段 
> ⏱ 2021-12-24 13:40:53 ^31608464-26-1032-1117

> 📌 将索引文件和数据文件按照列字段的粒度进行了拆分，每个列字段各自独立存储，以此进一步减少数据读取的范围。 
> ⏱ 2021-12-24 13:41:28 ^31608464-26-1153-1204

#### 1.6.4 水到渠成的ClickHouse时代

> 📌 那么这套方案就不可行，因为用户都讨厌等待。 
> ⏱ 2021-12-24 13:43:00 ^31608464-27-956-977

### 1.7 ClickHouse的名称含义

> 📌 至此，整个系统的逻辑就十分清晰了，那就是基于页面的点击事件流 
> ⏱ 2021-12-24 13:44:51 ^31608464-28-630-660

> 📌 ClickHouse的全称是Click Stream, Data WareHouse，简称ClickHouse 
> ⏱ 2021-12-24 13:45:22 ^31608464-28-678-733

### 1.8 ClickHouse适用的场景

> 📌 所以它基本能够胜任各种数据分析类的场景， 
> ⏱ 2021-12-24 13:45:50 ^31608464-29-641-661

> 📌 并且随着数据体量的增大，它的优势也会变得越为明显。 
> ⏱ 2021-12-24 13:45:57 ^31608464-29-661-686

> 📌 它也能够被广泛应用于广告流量、Web、App流量、 
> ⏱ 2021-12-24 13:46:13 ^31608464-29-756-781

### 1.9 ClickHouse不适用的场景

> 📌 不支持事务。 
> ⏱ 2021-12-24 13:46:57 ^31608464-30-558-564

> 📌 不擅长根据主键按行粒度进行查询（虽然支持），故不应该把ClickHouse当作Key-Value数据库使用。 
> ⏱ 2021-12-24 13:46:47 ^31608464-30-595-649

> 📌 不擅长按行删除数据（虽然支持）。 
> ⏱ 2021-12-24 13:46:52 ^31608464-30-680-696

## 第2章 ClickHouse架构概述

> 📌 那么ClickHouse俨然就是一辆手动挡的赛车。 
> ⏱ 2021-12-24 13:57:14 ^31608464-33-922-947

> 📌 特别是在分片和副本方面，有些时候数据的分片甚至需要手动完成 
> ⏱ 2021-12-24 13:57:24 ^31608464-33-996-1025

> 📌 它没有采用Hadoop生态中常用的主从架构，而是使用了多主对等网络结构，同时它也是基于关系模型的ROLAP方案 
> ⏱ 2021-12-24 13:58:06 ^31608464-33-1139-1194

### 2.1 ClickHouse的核心特性

> 📌 ClickHouse是一款MPP架构的列式存储数据库， 
> ⏱ 2021-12-24 14:37:23 ^31608464-34-450-477

> 📌 但MPP 
> ⏱ 2021-12-24 14:38:12 ^31608464-34-477-481

> 📌 列式存储 
> ⏱ 2021-12-24 14:37:26 ^31608464-34-482-486

#### 2.1.1 完备的DBMS功能

> 📌 ❑ DDL（数据定义语言）：可以动态地创建、修改或删除数据库、表和视图，而无须重启服务。❑ DML（数据操作语言）：可以动态查询、插入、修改或删除数据。❑ 权限控制：可以按照用户粒度设置数据库或者表的操作权限，保障数据的安全性。❑ 数据备份与恢复：提供了数据备份导出与导入恢复机制，满足生产环境的要求。❑ 分布式管理：提供集群模式，能够自动管理多个数据库节点。 
> ⏱ 2021-12-24 16:05:17 ^31608464-35-579-875

#### 2.1.2 列式存储与数据压缩

> 📌 如果你想让查询变得更快，最简单且有效的方法是减少数据扫描范围和数据传输时的大小，而列式存储和数据压缩就可以帮助我们实现上述两点 
> ⏱ 2021-12-24 16:05:45 ^31608464-36-488-551

> 📌 列式存储是数据压缩的前提 
> ⏱ 2021-12-24 16:06:23 ^31608464-36-574-586

> 📌 按列存储与按行存储相比，前者可以有效减少查询时所需扫描的数据量 
> ⏱ 2021-12-24 16:07:32 ^31608464-36-616-647

> 📌 不难发现，尽管只需要前面的5个字段，但由于数据是按行进行组织的，实际上还是扫描了所有的字段。 
> ⏱ 2021-12-24 16:12:21 ^31608464-36-870-916

> 📌 由于数据按列组织，数据库可以直接获取A1～A5这5列的数据，从而避免了多余的数据扫描。 
> ⏱ 2021-12-24 16:12:38 ^31608464-36-936-979

# 读书笔记

# 本书评论
