---
doc_type: weread-highlights-reviews
bookId: "907755"
author: 户根勤
cover: https://cdn.weread.qq.com/weread/cover/15/YueWen_907755/t7_YueWen_907755.jpg
reviewCount: 1
noteCount: 179
readingStatus: 读完
progress: 100%
totalReadDay: 16
readingTime: 8小时1分钟
readingDate: 2022-07-04
finishedDate: 2022-07-22
isbn: 9787115441249
lastReadDate: 2022-07-22

---
# 元数据
> [!abstract] 网络是怎样连接的
> - ![ 网络是怎样连接的|200](https://cdn.weread.qq.com/weread/cover/15/YueWen_907755/t7_YueWen_907755.jpg)
> - 书名： 网络是怎样连接的
> - 作者： 户根勤
> - 简介： 本书以探索之旅的形式，从在浏览器中输入网址开始，一路追踪了到显示出网页内容为止的整个过程，以图配文，讲解了网络的全貌，并重点介绍了实际的网络设备和软件是如何工作的。目的是帮助读者理解网络的本质意义，理解实际的设备和软件，进而熟练运用网络技术。同时，专设了“网络术语其实很简单”专栏，以对话的形式介绍了一些网络术语的词源，颇为生动有趣。本书图文并茂，通俗易懂，非常适合计算机、网络爱好者及相关从业人员阅读。
> - 出版时间 2017-01-01 00:00:00
> - ISBN： 9787115441249
> - 分类： 计算机-计算机综合
> - 出版社： 人民邮电出版社
> - PC地址：https://weread.qq.com/web/reader/6f932ec05dd9eb6f96f14b9

# 高亮划线

## 译者序

> 📌 这需要配置一个DHCP服务器。 
> ⏱ 2022-07-05 15:23:27 ^907755-7-1452-1467

> 📌 或者配置PPP连接，还得配置相应的路由表。 
> ⏱ 2022-07-05 15:23:47 ^907755-7-1493-1514

> 📌 因为内网的电脑要访问外网，还得配置好网络地址转换（NAT） 
> ⏱ 2022-07-05 15:23:54 ^907755-7-1522-1551

## 前言

> 📌 但仅仅学习这些规则是无法看到设备和软件的内部构造的 
> ⏱ 2022-07-05 15:27:32 ^907755-8-995-1020

> 📌 考虑到上述原因，本书将重点介绍设备和软件的内部工作方式。 
> ⏱ 2022-07-05 15:28:15 ^907755-8-1166-1194

## 探索之旅路线图

> 📌 然后，网卡会将包转换为电信号并通过网线发送出去。这样一来，包就进入到网络之中了 
> ⏱ 2022-07-07 13:36:01 ^907755-10-2962-3001

> 📌 然后再通过ADSL和光纤到户（FTTH）等宽带线路接入互联网。 
> ⏱ 2022-07-07 13:39:18 ^907755-10-3267-3298

> 📌 到达用来接入互联网的路由器。路由器的后面就是互联网 
> ⏱ 2022-07-07 13:39:45 ^907755-10-3351-3376

> 📌 互联网的入口线路称为接入网。一般来说，我们可以用电话线、ISDN、ADSL、有线电视、光线、专线等多种通信线路来接入互联网，这些通信线路统称为接入网。接入网连接到签约的网络运营商，并接入被称为接入点（Point of Presence, PoP）的设备。 
> ⏱ 2022-07-08 12:49:56 ^907755-10-3593-3720

> 📌 它是一种可以连接几十根网线的高速大型路由器。 
> ⏱ 2022-07-08 12:52:46 ^907755-10-4144-4166

> 📌 。家庭和公司局域网中一般采用以太网线进行连接，而互联网中除了以太网线连接之外，还会使用比较古老的电话技术和最新的光通信技术来传送网络包 
> ⏱ 2022-07-08 12:53:52 ^907755-10-4281-4348

### 1.2 向DNS服务器查询Web服务器的IP地址

> 📌 在组建网络时，用户可以自行决定它们之间的分配关系，因此，我们还需要另外的附加信息来表示IP地址的内部结构。 
> ⏱ 2022-07-08 13:11:42 ^907755-14-2747-2800

> 📌 对于DNS服务器，我们的计算机上一定有相应的DNS客户端，而相当于DNS客户端的部分称为DNS解析器，或者简称解析器。通过DNS查询IP地址的操作称为域名解析，因此负责执行解析（resolution）这一操作的就叫解析器（resolver）了。 
> ⏱ 2022-07-08 13:14:52 ^907755-14-6144-6266

### 1.3 全世界DNS服务器的大接力

> 📌 实际上还有很多其他的类型。例如根据IP地址反查域名的PTR类型 
> ⏱ 2022-07-08 13:30:49 ^907755-15-3524-3555

> 📌 互联网中有数万台DNS服务器，肯定不能一台一台挨个去找。 
> ⏱ 2022-07-08 13:35:41 ^907755-15-6170-6198

> 📌 就是最顶层了，它们各自负责保存下级DNS服务器的信息，但实际上并非如此 
> ⏱ 2022-07-08 13:36:34 ^907755-15-6615-6650

> 📌 根域的DNS服务器中保管着com、jp等的DNS服务器的信息 
> ⏱ 2022-07-08 13:37:08 ^907755-15-6858-6888

> 📌 除此之外还需要完成另一项工作，那就是将根域的DNS服务器信息保存在互联网中所有的DNS服务器中 
> ⏱ 2022-07-08 13:37:29 ^907755-15-6979-7026

> 📌 。因此，客户端只要能够找到任意一台DNS服务器，就可以通过它找到根域DNS服务器，然后再一路顺藤摸瓜找到位于下层的某台目标DNS服务器 
> ⏱ 2022-07-08 13:37:48 ^907755-15-7058-7125

> 📌 分配给根域DNS服务器的IP地址在全世界仅有13个 
> ⏱ 2022-07-08 13:39:59 ^907755-15-7133-7158

> 📌 ，这样DNS服务器就能够从上万台DNS服务器中找到目标服务器。下 
> ⏱ 2022-07-08 18:20:17 ^907755-15-7464-7496

### 2.1 创建套接字

> 📌 而最下面的网卡则负责完成实际的收发操作，也就是对网线中的信号执行发送和接收的操作 
> ⏱ 2022-07-11 19:00:56 ^907755-19-2523-2563

> 📌 ，或者说存放 
> ⏱ 2022-07-11 19:02:41 ^907755-19-2905-2911

> 📌 控制信息的内存空间就是套接字的实体 
> ⏱ 2022-07-11 19:02:48 ^907755-19-2911-2928

> 📌 为此，套接字中必须要记录是否已经收到响应，以及发送数据后经过了多长时间，才能根据这些信息按照需要执行重发操作。 
> ⏱ 2022-07-11 19:03:17 ^907755-19-3301-3356

> 📌 套接字中记录了用于控制通信操作的各种控制信息，协议栈则需要根据这些信息判断下一步的行动，这就是套接字的作用。 
> ⏱ 2022-07-11 19:03:39 ^907755-19-3398-3452

> 📌 收到描述符之后，应用程序在向协议栈进行收发数据委托时就需要提供这个描述符。由于套接字中记录了通信双方的信息以及通信处于怎样的状态，所以只要通过描述符确定了相应的套接字，协议栈就能够获取所有的相关信息，这样一来，应用程序就不需要每次都告诉协议栈应该和谁进行通信了 
> ⏱ 2022-07-11 19:08:35 ^907755-19-6466-6596

### 2.2 连接服务器

> 📌 我们需要把服务器的IP地址和端口号等信息告知协议栈，这是连接操作的目的之一 
> ⏱ 2022-07-11 19:09:54 ^907755-20-1082-1119

### 2.3 收发数据

> 📌 此外，如图所示，客户端和服务器双方都需要各自计算序号，因此双方需要在连接过程中互相告知自己计算的序号初始值。 
> ⏱ 2022-07-12 13:18:46 ^907755-21-5983-6037

> 📌 到这里，序号和ACK号都已经准备完成了，接下来就可以进入数据收发阶段了。 
> ⏱ 2022-07-12 13:19:34 ^907755-21-6326-6362

> 📌 网卡、集线器、路由器都没有错误补偿机制，一旦检测到错误就直接丢弃相应的包。 
> ⏱ 2022-07-12 13:20:31 ^907755-21-7250-7287

> 📌 这种情况下，无论如何尝试都是徒劳，因此TCP会在尝试几次重传无效之后强制结束通信，并向应用程序报错 
> ⏱ 2022-07-12 13:20:54 ^907755-21-7388-7437

### 2.5 IP与以太网的包收发操作

> 📌 并记录到MAC头部中，大家可以理解为改写了MAC头 
> ⏱ 2022-07-13 01:00:50 ^907755-23-3058-3083

> 📌 ，因此只要确定了目标路由器，也就确定了应该使用哪块网卡，也就确定了发送方的IP地址 
> ⏱ 2022-07-14 00:38:27 ^907755-23-7658-7699

> 📌 因为协议栈的IP模块与路由器中负责包收发的部分都是根据IP协议规则来进行包收发操作的 
> ⏱ 2022-07-14 00:39:02 ^907755-23-7954-7996

> 📌 这个“IP表”叫作路由表 
> ⏱ 2022-07-14 00:39:09 ^907755-23-8048-8060

> 📌 ，这种网络的本质其实就是一根网线。 
> ⏱ 2022-07-14 09:12:49 ^907755-23-14791-14808

> 📌 ，网卡驱动程序会对硬件进行初始化操作 
> ⏱ 2022-07-15 22:00:47 ^907755-23-17765-17783

> 📌 图中显示了协议栈和网卡对包的处理过程。MAC头部很容易被误解为是由网卡来处理的，实际上它是由TCP/IP软件来负责的。 
> ⏱ 2022-07-15 22:04:55 ^907755-23-19716-19775

> 📌 。在这里，将数字信息转换为电信号的速率就是网络的传输速率，例如每秒将10 Mbit的数字信息转换为电信号发送出去，则速率就是10 Mbit/s。 
> ⏱ 2022-07-15 22:15:05 ^907755-23-23196-23268

> 📌 。以太网规格中对不同的网线类型和速率以及其对应的信号格式进行了规 
> ⏱ 2022-07-15 22:15:27 ^907755-23-23338-23370

> 📌 而是将可转换为任意格式的通用信号发送给 
> ⏱ 2022-07-15 22:15:48 ^907755-23-23387-23406

> 📌 换为可在网线上传输的格 
> ⏱ 2022-07-15 22:16:10 ^907755-23-23433-23444

> 📌 切换到操作系统中的中断处理程序[插图] 
> ⏱ 2022-07-15 22:22:22 ^907755-23-26801-26908

> 📌 在中断处理程序中则将硬件的中断号和相应的驱动程序绑定。 
> ⏱ 2022-07-15 22:22:52 ^907755-23-26997-27024

> 📌 中断号11和相应的网卡驱动绑定起来，当网卡发起中断时，就会自动调用网卡驱动了 
> ⏱ 2022-07-15 22:23:04 ^907755-23-27049-27087

> 📌 网卡驱动就会把这样的包交给TCP/IP协议栈；如果是809B则表示AppleTalk协议，就把包交给AppleTalk协议栈，以此类推[插图]。 
> ⏱ 2022-07-15 22:24:13 ^907755-23-27493-27676

> 📌 IP模块会通过ICMP消息将错误告知发送方（图 
> ⏱ 2022-07-15 22:25:33 ^907755-23-28654-28677

> 📌 并将数据放入缓冲区，等待应用程序来读取； 
> ⏱ 2022-07-15 22:31:34 ^907755-23-30104-30124

### 2.6 UDP协议的收发操作

> 📌 如果只有一个包，就不用考虑哪个包未送达了，因为全部重发也只不过是重发一个包而已， 
> ⏱ 2022-07-15 22:33:44 ^907755-24-1286-1326

> 📌 此外，我们发送了数据，对方一般都会给出回复，只要将回复的数据当作接收确认就行了，也不需要专门的接收确认包了 
> ⏱ 2022-07-15 22:34:00 ^907755-24-1384-1437

> 📌 询等交换控制信息的操作基本上都可以在一个包的大小范围内解决，这种场景中就可以用UDP来代替TCP 
> ⏱ 2022-07-15 22:34:18 ^907755-24-1584-1632

> 📌 除此之外，UDP协议没有其他功能了，遇到错误或者丢包也一概不管 
> ⏱ 2022-07-15 22:34:51 ^907755-24-2190-2221

> 📌 因此出错时就收不到来自对方的回复，应用程序会注意到这个问题，并重新发送一遍数据。这样的操作本身并不复杂，也并不会增加应用程序的负担。 
> ⏱ 2022-07-15 22:35:14 ^907755-24-2290-2356

> 📌 这些无需重发数据，或者是重发了也没什么意义的情况下，使用UDP发送数据的效率会更高 
> ⏱ 2022-07-15 22:40:16 ^907755-24-3298-3339

## 第3章 从网络到网络设备——探索集线器、交换机和路由器

> 📌 然后再重新转换成信号并发送出去的过程。 
> ⏱ 2022-07-15 23:22:11 ^907755-26-2112-2131

### 3.1 信号在网线和集线器中传输

> 📌 实际上，我们家里用的路由器已经集成了集线器和交换机的功能 
> ⏱ 2022-07-15 23:26:57 ^907755-27-1153-1181

### 3.3 路由器的包转发操作

> 📌 通过更换网卡，计算机不仅可以支持以太网，也可以支持无线局域网，路由器也是一样 
> ⏱ 2022-07-16 17:11:16 ^907755-29-1329-1367

> 📌 此外，计算机的网卡除了以太网和无线局域网之外很少见到支持其他通信技术的品种 
> ⏱ 2022-07-16 17:12:11 ^907755-29-1404-1441

> 📌 如ADSL、FTTH，以及各种宽带专线等，只要端口模块安装了支持这些技术的硬件即可[插图]。 
> ⏱ 2022-07-16 17:12:37 ^907755-29-1468-1643

> 📌 当转发包时，首先路由器端口会接收发给自己的以太网包[插图]，然后查询转发目标，再由相应的端口作为发送方将以太网包发送出去。这一点和交换机是不同的，交换机只是将进来的包转发出去而已，它自己并不会成为发送方或者接收方。 
> ⏱ 2022-07-17 01:05:17 ^907755-29-2294-2518

> 📌 如果在路由表中无法找到匹配的记录，路由器会丢弃这个包，并通过ICMP[插图]消息告知发送方[插图]。这里的处理方式和交换机不同，原因在于网络规模的大小。 
> ⏱ 2022-07-17 19:54:21 ^907755-29-8288-8578

> 📌 网络包就会被转发到互联网接入路由器 
> ⏱ 2022-07-17 19:55:52 ^907755-29-9629-9646

> 📌 计算机上也有一张和路由器一样的路由表，其中默认网关的地址就是我们在设置窗口中填写的地址。 
> ⏱ 2022-07-17 19:56:34 ^907755-29-9715-9759

> 📌 128，也就是说包经过这么多路由器后就会“寿终正寝”。现在的互联网即便访问一台位于地球另一侧的服务器，最多也只需要经过几十个路由器 
> ⏱ 2022-07-17 19:58:06 ^907755-29-10454-10519

> 📌 路由器的端口并不只有以太网一种，也可以支持其他局域网或专线通信技术。 
> ⏱ 2022-07-17 19:58:25 ^907755-29-10678-10712

> 📌 也可能会因为添加了一些头部数据而导致包的实际长度发生变化，ADSL、FTTH等宽带接入技术中使用的PPPoE[插图]协议就属于这种情况。 
> ⏱ 2022-07-17 19:59:24 ^907755-29-10906-11099

> 📌 在家庭网络中，路由器后面一般连接ADSL等线路接入互联网，因此路由器会根据接入网的规则来发送包。 
> ⏱ 2022-07-17 20:03:09 ^907755-29-12816-12864

> 📌 也就是说，如果和下一个路由器之间是通过无线局域网连接的，那么就委托无线局域网将包传输过去； 
> ⏱ 2022-07-18 09:11:54 ^907755-29-16065-16110

> 📌 IP本身不负责包的传输，而是委托各种通信技术将包传输到下一个路由器，这样的设计是有重要意义的，即可以根据需要灵活运用各种通信技术，这也是IP的最大特点。正是有了这一特点，我们才能够构建出互联网这一规模巨大的网络。 
> ⏱ 2022-07-18 09:14:13 ^907755-29-16227-16333

### 3.4 路由器的附加功能

> 📌 。比如，公司内网需要接入互联网的时候，应该向地址管理机构申请IP地址，并将它们分配给公司里的每台设备。换句话说，那个时候没有内网和外网的区别，所有客户端都是直接连接到互联网的。 
> ⏱ 2022-07-18 09:15:06 ^907755-30-820-908

> 📌 地址转换的基本原理是在转发网络包时对IP头部中的IP地址和端口号[插图]进行改写。 
> ⏱ 2022-07-18 09:58:48 ^907755-30-2784-2926

> 📌 这里使用的公有地址是地址转换设备[插图]的互联网接入端口的地址 
> ⏱ 2022-07-18 09:59:26 ^907755-30-3051-3227

> 📌 地址转换设备会随机选择一个空闲的端口。然后，改写前的私有地址和端口号，以及改写后的公有地址和端口号，会作为一组相对应的记录保存在地址转换设备内部的一张表中。 
> ⏱ 2022-07-18 09:59:55 ^907755-30-3244-3322

> 📌 当数据收发结束，进入断开阶段，访问互联网的操作全部完成后，对应表中的记录就会被删除。 
> ⏱ 2022-07-18 10:01:29 ^907755-30-3992-4034

## 第4章 通过接入网进入互联网内部——探索接入网和网络运营商

> 📌 而多个运营商之间相互连接的部分可以说就是互联网的核心部分，这里也是本章的看 
> ⏱ 2022-07-18 12:58:47 ^907755-32-2695-2732

### 4.1 ADSL接入网的结构和工作方式

> 📌 因为你家到最近的电话局 
> ⏱ 2022-07-18 13:01:07 ^907755-33-1198-1209

> 📌 距离的不同和路由的维护方式，就是互联网与家庭、公司网络之间最主要的两个不同点。 
> ⏱ 2022-07-18 13:02:39 ^907755-33-1601-1640

> 📌 不过，互联网接入路由器发送网络包的操作和以太网路由器有一点不同， 
> ⏱ 2022-07-18 13:04:21 ^907755-33-2121-2153

> 📌 入网规则来发送包的 
> ⏱ 2022-07-18 13:04:26 ^907755-33-2165-2174

> 📌 ADSL技术中，上行方向（用户到互联网）和下行方向（互联网到用户）的传输速率是不同的，原因也在这里。如果上行使用26个频段，下行则可以使用95个或者223个频段，波的数量不同，导致了上下行速率不同。 
> ⏱ 2022-07-18 13:22:34 ^907755-33-8481-8580

> 📌 因此，ADSL会持续检查线路质量，动态判断使用的频段数量，以及每个频段分配到的比特数。 
> ⏱ 2022-07-18 13:23:27 ^907755-33-8780-8823

> 📌 当Modem通电后，会发送测试信号，并根据信号的接收情况判断使用的频段数量和每个频段的比特数，这个过程称为训练（握手），需要几秒到几十秒的时间。 
> ⏱ 2022-07-18 13:23:44 ^907755-33-8828-8900

> 📌 然后ADSL信号会和电话的语音信号混合起来一起从电话线传输出去 
> ⏱ 2022-07-18 13:25:30 ^907755-33-9065-9096

> 📌 。电话线传入的信号是电话的语音信号和ADSL信号混合在一起的，如果这个混合信号直接进入电话机，ADSL信号就会变成噪音，导致电话难以听清 
> ⏱ 2022-07-18 13:26:19 ^907755-33-9237-9305

> 📌 以确保ADSL信号不会传入电话机 
> ⏱ 2022-07-18 13:26:46 ^907755-33-9333-9349

> 📌 ，也就是过滤掉了ADSL使用的高频信号 
> ⏱ 2022-07-18 13:26:57 ^907755-33-9375-9394

> 📌 这样一来，只有电话信号才会传入电话机 
> ⏱ 2022-07-18 13:27:07 ^907755-33-9395-9413

> 📌 如果没有分离器，拿起电话听筒接通电话的状态，和放下听筒挂断电话的状态下，信号的传输方式是不同的。 
> ⏱ 2022-07-18 13:29:49 ^907755-33-9904-9952

> 📌 由于电话线必须进入很多住宅和大楼，所以电话局附近就会集结数量庞大的电缆 
> ⏱ 2022-07-18 13:36:15 ^907755-33-11233-11268

> 📌 在电话局附近，电话线都是埋在地下的。由于电话局附近的地下电缆很多，集中埋设电缆的地方就形成了一条地道，这部分称为电缆隧道 
> ⏱ 2022-07-18 13:36:38 ^907755-33-11340-11400

> 📌 虽然电话线和以太网双绞线的结构有所不同，但它们都是用金属信号线传输电信号，本质上是共通的 
> ⏱ 2022-07-18 13:37:56 ^907755-33-11822-11866

> 📌 电话线原本的设计并没有考虑到传输ADSL这样的高频信号，从这个角度上可以说它比以太网双绞线更容易受到噪声的干扰。 
> ⏱ 2022-07-18 13:38:26 ^907755-33-12023-12079

> 📌 MAC头部和PPPoE头部的作用是将包送达BAS的接口，当接口完成接收工作后，它们就完成了使命 
> ⏱ 2022-07-18 13:41:59 ^907755-33-13774-13821

> 📌 BAS会在包的前面加上隧道专用头部[插图]，并发送到隧道的出口（ 
> ⏱ 2022-07-18 13:42:41 ^907755-33-13871-13999

### 4.2 光纤接入网（FTTH）

> 📌 波长不同的光混合后可通过棱镜原理进行分离，因此光纤中的上行和下行信号即便混合起来也可以识别。像这样在一条光纤中使用不同的波长传输多个光信号的方式叫作波分复用。 
> ⏱ 2022-07-20 13:20:13 ^907755-34-5935-6014

### 4.3 接入网中使用的PPP和隧道

> 📌 首先，用户向运营商的接入点拨打电话（图4.17①-1），电话接通后（图4.17①-2）输入用户名和密码进行登录操作（图4.17②-2）。用户名和密码通过RADIUS[插图]协议从RAS[插图]发送到认证服务器，认证服务器校验这些信息是否正确。当确认无误后，认证服务器会返回IP地址等配置信息，并将这些信息下发给用户（图4.17②-3）。用户的计算机根据这些信息配置IP地址等参数，完成TCP/IP收发网络包的准备工作，接下来就可以发送TCP/IP包了（图4.17③）。 
> ⏱ 2022-07-20 13:26:50 ^907755-35-1577-2027

> 📌 不过，ADSL和FTTH中，用户和BAS之间是通过电缆或光纤固定连接在一起的， 
> ⏱ 2022-07-20 13:28:52 ^907755-35-2651-2690

> 📌 所以实际上并不需要PPP的所有这些功能。 
> ⏱ 2022-07-20 13:29:01 ^907755-35-2703-2723

> 📌 因此，接入运营商在ADSL和FTTH中一般也会使用PPP[插图] 
> ⏱ 2022-07-20 13:29:34 ^907755-35-2876-3010

> 📌 将PPP消息装在这个容器里才行。于是，在拨号接入中PPP借用了HDLC[插图]协议作为容器，而HDLC协议原本是为在专线中传输网络包而设计的，拨号接入方式对这一规格进行了一些修正。 
> ⏱ 2022-07-20 13:30:40 ^907755-35-3252-3446

> 📌 所谓隧道，就类似于套接字之间建立的TCP连接。 
> ⏱ 2022-07-20 13:33:05 ^907755-35-4572-4595

> 📌 中还介绍了另一种基于封装（encapsulation）的隧道实现方式，这种方式是将包含头部在内的整个包装入另一个包中传输到隧道的另一端。 
> ⏱ 2022-07-20 13:35:06 ^907755-35-5219-5287

> 📌 都实现了一个可供包进行穿梭的通道。 
> ⏱ 2022-07-20 13:35:24 ^907755-35-5334-5351

> 📌 接入网的工作从用户端的互联网接入路由器进行连接操作开始。首先，接入路由器中需要配置运营商分配的用户名和密码[插图]。然后，接入路由器会根据PPPoE的发现机制来寻找BAS。 
> ⏱ 2022-07-20 13:40:26 ^907755-35-5839-6060

> 📌 。大家可以认为前面这个过程相当于拨号上网中拨通电话的动作（图4.17 
> ⏱ 2022-07-20 13:41:12 ^907755-35-6273-6307

> 📌 要么在路由器和ADSL Modem中间进行窃听，要么爬到电线杆上安装窃听装置拾取电缆中泄漏的电磁波。不过， 
> ⏱ 2022-07-20 13:42:08 ^907755-35-7032-7085

> 📌 光纤是不会泄漏电磁波的，因此无法通过第二种方式进行窃听。 
> ⏱ 2022-07-20 13:42:22 ^907755-35-7085-7113

> 📌 下发的配置信息包括分配给上网设备的IP地址[插图]、DNS服务器的IP地址以及默认网关的IP地址 
> ⏱ 2022-07-20 13:42:39 ^907755-35-7179-7300

> 📌 路由器会根据这些信息配置自身的参数 
> ⏱ 2022-07-20 13:42:52 ^907755-35-7314-7331

> 📌 只不过在通过路由表判断转发目标之后，包不是按照以太网规则转发，而是按照PPPoE规则转发 
> ⏱ 2022-07-20 13:46:51 ^907755-35-7962-8006

> 📌 由于PPPoA没有MAC头部，所以PPP消息是无法通过以太网来传输的，这就意味着需要和BAS收发PPP消息的设备，也就是计算机和路由器，必须和ADSL Modem是一体的，否则PPP机制就无法工作了。这个一体化的方式主要有以下两种。 
> ⏱ 2022-07-21 00:49:16 ^907755-35-11911-12027

> 📌 当由于地址转换产生问题时，这种方式就不容易处理了，因为我们无法抛开路由器用计算机直接上网。 
> ⏱ 2022-07-21 00:50:57 ^907755-35-12218-12263

> 📌 有一些运营商不使用PPP，他们使用DHCP[插图]协议从BAS向用户端下发TCP/IP配置信息。 
> ⏱ 2022-07-21 00:52:22 ^907755-35-12863-13022

> 📌 不需要像PPP（图4.17）那样需要多个步骤，也不需要验证用户名和密码。 
> ⏱ 2022-07-21 00:52:46 ^907755-35-13146-13182

> 📌 但这种方式也有优势，它可以单纯地直接传输以太网包 
> ⏱ 2022-07-21 00:53:01 ^907755-35-13211-13235

> 📌 ，这种ADSL Modem不使用信元，而是直接将以太网包调制成ADSL信号，因此没有ADSL Modem和路由器无法分离的问题 
> ⏱ 2022-07-21 00:53:37 ^907755-35-13574-13637

### 4.4 网络运营商的内部

> 📌 ADSL、FTTH等接入网是与用户签约的运营商设备相连的，这些设备称为POP[插图]，互联网的入口就位于这里。 
> ⏱ 2022-07-21 09:03:59 ^907755-36-834-984

> 📌 拨号接入需要对用户拨电话的动作进行应答，而RAS就具备这样的功能。 
> ⏱ 2022-07-21 09:14:04 ^907755-36-2035-2068

> 📌 此外，之前我们讲过通过PPP协议进行身份认证和配置下发的过程，RAS也具备这些功能 
> ⏱ 2022-07-21 09:14:40 ^907755-36-2068-2109

> 📌 NOC[插图]是运营商的核心设备，从POP传来的网络包都会集中到这里，并从这里被转发到离目的地更近的POP，或者是转发到其他的运营商。这里也需要配备高性能的路由器。 
> ⏱ 2022-07-21 09:16:19 ^907755-36-2772-2951

> 📌 NOC就是规模扩大后的POP[插图]。 
> ⏱ 2022-07-21 09:17:24 ^907755-36-3427-3594

> 📌 但看起来跟公司里的机房没什么太大区别，都是位于一幢建筑物中的，其 
> ⏱ 2022-07-21 09:17:42 ^907755-36-3750-3782

> 📌 只不过，公司的机房一般使用双绞线来连接设备，但运营商的网络中需要传输大量的包，已经超过了双绞线能容纳的极限，因此一般还是更多地使用光纤[插图]。 
> ⏱ 2022-07-21 09:18:19 ^907755-36-3827-3999

> 📌 因此，只有有限的几家大型运营商才拥有光纤。 
> ⏱ 2022-07-21 09:18:47 ^907755-36-4439-4460

> 📌 电话公司可以将自己的光纤的一部分通信能力租借给客户。对于客户来说，只要支付一定的费用就可以使用其中的通信能力了。对于电话公司来说，其拥有的光纤不会全部自己使用，通过租借的方式也可以带来一定的收益， 
> ⏱ 2022-07-21 09:19:31 ^907755-36-4665-4763

> 📌 这种服务就叫作通信线路服务。 
> ⏱ 2022-07-21 09:19:36 ^907755-36-4877-4891

> 📌 不拥有光纤的运营商则可以使用租借通信线路的方式将相距较远的NOC和POP连接起来 
> ⏱ 2022-07-21 09:19:51 ^907755-36-4920-4960

> 📌 电话使用的通信线路（电话线）只能传输语音这种单一形式的数据，但运营商使用的通信线路则种类繁多。 
> ⏱ 2022-07-21 09:20:01 ^907755-36-4961-5008

### 4.5 跨越运营商的网络包

> 📌 运营商的路由器可以和其他路由器交换路由信息，从而自动更新自己的路由表，通过这一功能，路由信息就实现了自动化管理[插图]。 
> ⏱ 2022-07-21 12:55:12 ^907755-37-679-816

> 📌 这个路由信息交换的过程是由路由器自动完成的，这里使用的机制称为BGP[插图]。 
> ⏱ 2022-07-21 12:57:12 ^907755-37-2040-2175

> 📌 通过运营商D来发送网络包的方式称为转接。 
> ⏱ 2022-07-21 12:58:10 ^907755-37-2344-2364

> 📌 现在光日本国内就有数千家运营商， 
> ⏱ 2022-07-21 13:04:42 ^907755-37-4480-4496

> 📌 设置一个中心设备，通过连接到中心设备的方式来减少线路数量，这个中心设备就称为IX。 
> ⏱ 2022-07-21 13:05:12 ^907755-37-4530-4571

> 📌 IX的核心是具有大量高速以太网[插图]端口的二层交换机（图4.28）[插图]。二层交换机的基本原理和一般交换机相同，大家可以认为IX的核心就是大型的、高速的交换机。 
> ⏱ 2022-07-21 13:06:19 ^907755-37-5787-6084

> 📌 不过实际上，要成功发送包还需要正确的路由信息，对于没有进行路由交换的运营商，我们是无法向其发送包的。这需要运营商之间通过谈判签订合约，然后按照合约来交换路由信息，实现网络包的收发。 
> ⏱ 2022-07-21 13:10:04 ^907755-37-6708-6798

### CoIumn网络术语其实很简单

> 📌 只要有相应的软件，计算机什么都能干。 
> ⏱ 2022-07-21 13:12:32 ^907755-38-1585-1603

> 📌 现在的计算机也可以当路由器用哦。Linux等UNIX系操作系统都内置了路由功能，Windows Server版本也具有路由功能。 
> ⏱ 2022-07-21 13:13:19 ^907755-38-2050-2114

> 📌 不不，跟数据库、业务系统相比，转发包算是简单的工作了。 
> ⏱ 2022-07-21 13:16:29 ^907755-38-2576-2603

> 📌 让昂贵的计算机做这么简单的事太浪费了，有人就想，如果设计一种专用设备，是不是能节省成本呢？于是就有了路由器。 
> ⏱ 2022-07-21 13:16:40 ^907755-38-2728-2782

> 📌 现在使用专用硬件不是为了降低成本，而是为了提高性能。 
> ⏱ 2022-07-21 13:16:47 ^907755-38-2928-2954

> 📌 专用硬件可以通过芯片实现非常快速的处理，因此性能更好。 
> ⏱ 2022-07-21 13:17:49 ^907755-38-3219-3246

### 5.1 Web服务器的部署地点

> 📌 5.1.2 将Web服务器部署在数据中心 
> ⏱ 2022-07-21 13:20:30 ^907755-40-2244-2271

> 📌 这样把服务器放在网络运营商等管理的数据中心里，或者直接租用运营商提供的服务器 
> ⏱ 2022-07-21 13:20:49 ^907755-40-2361-2399

> 📌 数据中心通过高速线路直接连接到互联网的核心部分，因此将服务器部署在这里可以获得很高的访问速度[插图]，当服务器访问量很大时这是非常有效的。 
> ⏱ 2022-07-21 13:21:35 ^907755-40-2476-2642

### 5.2 防火墙的结构和原理

> 📌 而且市面上销售的防火墙大多是专用的硬件设备或者软件，这也加深了大家的这种印象。 
> ⏱ 2022-07-21 13:25:22 ^907755-41-6760-6799

### 5.3 通过将请求平均分配给多台服务器来平衡负载

> 📌 最简单的一种是通过DNS服务器来分配。当访问服务器时，客户端需要先向DNS服务器查询服务器的IP地址，如果在DNS服务器中填写多个名称相同的记录，则每次查询时DNS服务器都会按顺序返回不同的IP地址。 
> ⏱ 2022-07-21 13:26:53 ^907755-42-1078-1178

### 5.4 使用缓存服务器分担负载

> 📌 消息从浏览器传输到Web服务器的路径中，当消息经过时进行拦截 
> ⏱ 2022-07-21 13:33:17 ^907755-43-8284-8314

> 📌 如果请求消息有多条路径可以到达Web服务器，那么就必须在这些路径上都放置透明代理，因此一般是将网络设计成只有一条路可以走的结构 
> ⏱ 2022-07-21 13:33:45 ^907755-43-8359-8422

> 📌 连接互联网的接入网就是这样一个关口，因此可以在接入网的入口处放置反向代理[插图]。使用透明代理时，用户不会察觉到代理的存在，也不会注意到HTTP消息是如何被转发的，因此大家更倾向于将透明代理说成是缓存[插图]。 
> ⏱ 2022-07-21 13:34:32 ^907755-43-8439-8755

### 5.5 内容分发服务

> 📌 Web服务器运营者和网络运营商签约，将可以自己控制的缓存服务器放在客户端的运营商处。 
> ⏱ 2022-07-21 13:38:00 ^907755-44-1299-1341

> 📌 ，我们可以把缓存服务器部署在距离用户很近的地方，同时Web服务器运营者还可以控制这些服务器 
> ⏱ 2022-07-21 13:38:15 ^907755-44-1374-1419

> 📌 如何才能从这些服务器中找到离客户端最近的一个，并让客户端去访问那台服务器呢？ 
> ⏱ 2022-07-21 13:40:33 ^907755-44-2722-2760

> 📌 第一个方法是像负载均衡一样用DNS服务器来分配访问。 
> ⏱ 2022-07-21 13:41:07 ^907755-44-3168-3194

> 📌 我们可以在DNS服务器返回Web服务器IP地址时，对返回的内容进行一些加工，使其能够返回距离客户端最近的缓存服务器的IP地址。 
> ⏱ 2022-07-21 13:42:10 ^907755-44-3199-3262

> 📌 如果按照DNS服务器的一般工作方式来看，它只能以轮询方式按顺序返回IP地址，完全不考虑客户端与缓存服务器的远近，因此可能会返回离客户端较远的缓存服务器IP地址。 
> ⏱ 2022-07-21 13:47:40 ^907755-44-4121-4201

> 📌 重定向服务器和刚才一种方法中的DNS服务器一样，收集了来自各个路由器的路由信息，并根据这些信息找到最近的缓存服务器，然后将缓存服务器的地 
> ⏱ 2022-07-21 23:44:30 ^907755-44-5547-5615

> 📌 址放到Location字段中返回响应 
> ⏱ 2022-07-21 23:44:35 ^907755-44-5615-5633

> 📌 客户端就会重新去访问指定的缓存服务器了 
> ⏱ 2022-07-21 23:44:40 ^907755-44-5637-5656

> 📌 对DNS服务器进行扩展的方法是估算客户端DNS服务器到缓存服务器之间的距离，因此精度较差；相对而言，重定向的方法是根据客户端发送来的HTTP消息的发送方IP地址来估算距离的，因此精度较高。 
> ⏱ 2022-07-21 23:45:56 ^907755-44-6248-6342

> 📌 返回一个通过网络包往返时间估算到缓存服务器的距离的脚本 
> ⏱ 2022-07-21 23:47:41 ^907755-44-6442-6469

> 📌 要改善这一点，有一种方法是让Web服务器在原始数据发生更新时，立即通知缓存服务器，使得缓存服务器上的数据一直保持最新状态，这样就不需要每次确认原始数据是否有变化了，而且从第一次访问就可以发挥缓存的效果。内容分发服务采用的缓存服务器就具备这样的功能。 
> ⏱ 2022-07-21 23:50:30 ^907755-44-6893-7017

> 📌 这种情况下，我们可以不保存整个页面，而是将应用程序生成的部分，也就是每次内容都会发生变化的动态部分，与内容不会发生变化的静态部分分开，只将静态部分保存在缓存中。 
> ⏱ 2022-07-21 23:53:07 ^907755-44-7110-7190

### CoIumn网络术语其实很简单

> 📌 使用现在的光纤技术，的确可以将线路延伸到几十公里，因此用局域网技术也可以将距离很远的地方连接起来。 
> ⏱ 2022-07-21 23:54:53 ^907755-45-2957-3006

### 6.1 服务器概览

> 📌 置好端口号之后，协议栈会调用listen向套接字写入等待连接状态这一控制信息（图6.2（2-1））。这样一来，套接字就会开始等待来自客户端的连接网络包 
> ⏱ 2022-07-22 00:05:27 ^907755-47-5281-5356

> 📌 接下来，协议栈会给等待连接的套接字复制一个副本，然后将连接对象等控制信息写入新的套接字中 
> ⏱ 2022-07-22 00:06:15 ^907755-47-5631-5675

> 📌 其实它还会以等待连接的状态继续存在，当再次调用accept，客户端连接包到达时，它又可以再次执行接受连接操作 
> ⏱ 2022-07-22 00:06:42 ^907755-47-6216-6270

### 6.2 服务器的接收操作

> 📌 网卡驱动会根据MAC头部判断协议类型，并将包交给相应的协议栈。 
> ⏱ 2022-07-22 00:08:55 ^907755-48-3350-3381

> 📌 收到数据包时，TCP模块会（1）根据收到的包的发送方IP地址、发送方端口号、接收方IP地址、接收方端口号找到相对应的套接字；（2）将数据块拼合起来并保存在接收缓冲区中；（3）向客户端返回ACK。 
> ⏱ 2022-07-22 00:10:38 ^907755-48-7388-7485

### 6.3 Web服务器程序解释请求消息并作出响应

> 📌 。但URI指定的文件内容不仅限于HTML文档，也有可能是一个程序。在这个情况下，服务器不会直接返回文件内容，而是会运行这个程序，然后将程序输出的数据返回给客户端。 
> ⏱ 2022-07-22 00:12:35 ^907755-49-3497-3578

> 📌 如果判断要访问的文件为程序文件，Web服务器会委托操作系统运行这个程序，然后从请求消息中取出数据并交给运行的程序[插图]。如果方法为GET，则将URI后面的参数传递给程序；如果方法为POST，则将消息体中的数据传递给程序（图6.11）。 
> ⏱ 2022-07-22 00:14:19 ^907755-49-4638-4841

### 6.4 浏览器接收响应消息并显示内容

> 📌 Web服务器可能还会返回其他一些类型的数据，如文字处理、幻灯片等应用程序的数据。这些数据无法由浏览器自行显示，这时浏览器会调用相应的程序。这些程序可以是浏览器的插件，也可以是独立的程序，无论如何，不同类型的数据对应不同的程序，这一对应关系是在浏览器中设置好的，只要按照这一对应关系调用相应的程序，并将数据传递给它就可以了。 
> ⏱ 2022-07-22 00:15:44 ^907755-50-3664-3825

### CoIumn网络术语其实很简单

> 📌 通往异世界的入口就是gateway啦。 
> ⏱ 2022-07-22 00:16:37 ^907755-51-1219-1245

> 📌 CGI（Common Gateway Interface，通用网关接口） 
> ⏱ 2022-07-22 00:16:52 ^907755-51-1400-1436

> 📌 CGI指的不是CGI程序本身，而是连接程序与Web服务器程序的接口规格。所以说，客户端发送的消息是通过CGI这样一个接口，从Web服务器程序进入CGI程序的。 
> ⏱ 2022-07-22 00:17:33 ^907755-51-1932-2011

> 📌 一开始并没有路由器这个词，那时候是管路由器叫网关的。从某种角度来说，路由器就是通向另一个网络的入口，所以默认网关的叫法也是那时候遗留下来的。 
> ⏱ 2022-07-22 00:18:03 ^907755-51-2511-2581

## 后记

> 📌 但这还仅仅是网络世界的一小部分而已，还有很多内容我们无法一一讲解，如果深入挖掘其中一些细节也是难以穷尽的。网络的复杂度由此可见一斑。 
> ⏱ 2022-07-22 00:19:34 ^907755-53-508-574

## 作者简介

> 📌 。那时，我们从几家不同的厂商搞了一些网线和网卡等设备 
> ⏱ 2022-07-22 00:20:03 ^907755-55-565-591

> 📌 后来，我就进入了网络行业，其中的细节就不多说了，主要是在外资网络设备厂商 
> ⏱ 2022-07-22 00:20:51 ^907755-55-771-807

# 读书笔记

# 本书评论

## 书评 No.1 
推荐 ^370982625-7AVqexAQB
⏱ 2022-07-22 00:21:52
